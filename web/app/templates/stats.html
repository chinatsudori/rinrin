{% extends "base.html" %}

{% macro ranking_card(title, ranking_data, unit='total') %}



<div class="card bg-gray-800 border-gray-700">
<h3 class="text-xl font-semibold text-white mb-4">{{ title }}</h3>
{% if ranking_data %}
<div class="overflow-x-auto">
<table class="min-w-full divide-y divide-gray-600">
<thead class="bg-gray-700">
<tr>
<th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Rank</th>
<th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">User ID</th>
<th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">{{ unit }}</th>
</tr>
</thead>
<tbody class="bg-gray-800 divide-y divide-gray-700">
{% for row in ranking_data %}
<tr>
<td class="px-4 py-2 whitespace-nowrap text-sm text-gray-300">{{ loop.index }}</td>
<td class="px-4 py-2 whitespace-nowrap text-sm text-gray-400 font-mono">{{ row.user_id }}</td>
<td class="px-4 py-2 whitespace-nowrap text-sm text-white font-semibold">{{ "{:,.0f}".format(row.value) }}</td>
</tr>
{% endfor %}
</tbody>
</table>
</div>
{% else %}
<p class="text-gray-400">No data available for this ranking.</p>
{% endif %}
</div>
{% endmacro %}

{% block content %}

<div class="container mx-auto px-4 py-8">
<h1 class="text-3xl font-bold text-white mb-6">Server Statistics</h1>

<div class="card bg-yellow-900 border-yellow-700 text-yellow-100 p-4 mb-6">
    <h4 class="font-bold text-lg mb-2">Note on Data Availability</h4>
    <p class="text-sm">
        This dashboard shows rankings based on data found in the <strong>message_archive</strong> table.
        Usernames are not stored, so rankings are by User ID.
    </p>
    <p class="text-sm mt-2">
        <strong>The following stats are not currently logged by the bot and cannot be displayed:</strong>
    </p>
    <ul class="list-disc list-inside text-sm pl-2 mt-1">
        {% for stat in missing_stats %}
        <li>{{ stat }}</li>
        {% endfor %}
    </ul>
</div>

{% if error %}
<div class="card bg-red-900 border-red-700 text-red-100 p-4 mb-6">
    <h4 class="font-bold text-lg mb-2">Database Error</h4>
    <p class="text-sm font-mono">{{ error }}</p>
</div>
{% else %}
<!-- Grid for Ranking Cards -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">

    {{ ranking_card("Total Messages", rankings.total_messages) }}

    {{ ranking_card("Total Words (Est.)", rankings.total_words, 'words') }}

    {{ ranking_card("Distinct Active Hours", rankings.active_hours, 'hours') }}

    {{ ranking_card("GIFs Sent", rankings.total_gifs, 'GIFs') }}

    {{ ranking_card("Reactions Received", rankings.reactions_received, 'reactions') }}

    {{ ranking_card("Mentions Sent", rankings.mentions_sent, 'mentions') }}

    {{ ranking_card("Replies Sent", rankings.replies_sent, 'replies') }}

</div>
{% endif %}


</div>
{% endblock %}

